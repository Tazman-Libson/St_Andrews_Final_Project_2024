"0","#Plotting 2D- Multivariate Conditional CDF"
"0","#Reduce Model"
"0","big2dmodel <- list("
"0","  MEANS = big_mod$MEANS[,3:4],"
"0","  CORR = big_mod$CORR[3:4,3:4,],"
"0","  VARS = big_mod$VARS[,3:4],"
"0","  TPM = big_mod$TPM,"
"0","  ID = big_mod$ID"
"0",")"
"0",""
"0","cond_dist_mat_vec2d <- function(obs_matrix, N = 10000){"
"0","  n <- dim(obs_matrix)[2]"
"0","  mat <- matrix(nrow = N**2, ncol = n)"
"0","  seq1 <-seq(min(-5), max(obs_matrix[,1]), length.out = N)"
"0","  seq2 <-seq(min(obs_matrix[,2]), max(obs_matrix[,2]), length.out = N)"
"0","  for(i in 1:N){"
"0","    mat[(N*(i-1)+1):(N*i),] <- matrix(c(rep(seq1[i], N), seq2), nrow = N, ncol =2)"
"0","  }"
"0","  return(mat)"
"0","}"
"0",""
"0","mvn.pdf_vector <- function(x,mod, obsmat, index){"
"0","  lenx         <- dim(x)[1]"
"0","  m         <- dim(mod$TPM)[1]"
"0","  dxc       <- matrix(NA,nrow=lenx,ncol=1)"
"0","  Px        <- matrix(NA,nrow=lenx,ncol=m)"
"0","  for (j in 1:lenx){ Px[j,] <- diag(mvn.p_matrix(mod, x[j,]))}"
"0","  la        <- mvn.lforward(obsmat,mod)"
"0","  lb        <- mvn.lbackward(obsmat,mod)"
"0","  la        <- rbind(log(mod$ID),la)"
"0","  lafact    <- apply(la,1,max)"
"0","  lbfact    <- apply(lb,1,max)"
"0","  for (i in 1:lenx)"
"0","  {"
"0","    foo      <- (exp(la[index,]-lafact[index])%*%mod$TPM)*exp(lb[index,]-lbfact[index])"
"0","    foo      <- foo/sum(foo)"
"0","    #if(i ==1){print(foo)}"
"0","    dxc[i]  <- sum(Px[i,]%*%t(foo))"
"0","  }"
"0","  return(dxc)"
"0","}"
"0","funny_matrix <- matrix(c(-5,5,-5,5), nrow = 2, byrow = F)"
"0",""
"0","cond_mat2d <-cond_dist_mat_vec2d(funny_matrix, 100)"
"0",""
"0",""
"0","cdfvals1 <- mvn.pdf_vector(cond_mat2d, big2dmodel, ret_matrix[,3:4], 500)"
"0","cdfvals2 <- mvn.pdf_vector(cond_mat2d, big2dmodel, ret_matrix[,1:2], 499)"
"0","cdfvals3 <- mvn.pdf_vector(cond_mat2d, big2dmodel, ret_matrix[,1:2], 501)"
"0","cdfvals4 <- mvn.pdf_vector(cond_mat2d, big2dmodel, ret_matrix[,1:2], 502)"
"0","cdf_df <- data.frame("
"0","  Intel_Return = cond_mat2d[,1],"
"0","  Meta_Return = cond_mat2d[,2],"
"0","  Feb_5_2022 = cdfvals2,"
"0","  Feb_4_2022 = cdfvals1,"
"0","  Feb_3_2022 = cdfvals3,"
"0","  Feb_2_2022 = cdfvals4"
"0",")"
"0",""
"0","big_cdf_df <- cdf_df %>%"
"0","  pivot_longer(c(Feb_2_2022, Feb_3_2022, Feb_4_2022, Feb_5_2022), values_to = 'pdf_eval', names_to = 'Date')"
"0",""
"0","ggplot(big_cdf_df, aes(x = Intel_Return, y = Meta_Return, z = pdf_eval))+"
"0","  geom_contour_filled()+"
"0","  facet_wrap(~Date)+"
"0","  labs("
"0","    title = 'Conditional PDFs on Different Days',"
"0","    x = 'Intel Return',"
"0","    y = 'Meta Return'"
"0","  )"
